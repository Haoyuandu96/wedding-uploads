<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Eric & Darya — 08·23·2025</title>
  <meta name="description" content="Share your photos & videos from Eric & Darya's wedding."/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {{
      --paper: #FAF7F2;
      --ink: #111111;
      --accent: #C9A227;
    }}
    html, body {{ background: var(--paper); color: var(--ink); }}
    body {{ font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }}
    .card {{ box-shadow: 0 10px 25px rgba(0,0,0,.07); }}
    .gold-grad {{
      background: radial-gradient(1200px 300px at 50% -50px, rgba(201,162,39,.25), rgba(201,162,39,0) 60%);
    }}
    .ring {{ filter: drop-shadow(0 4px 20px rgba(0,0,0,.12)); }}
  </style>
</head>
<body class="min-h-screen gold-grad">
  <main class="max-w-5xl mx-auto px-4 py-8 md:py-10">
    <!-- hero -->
    <header class="text-center mb-8">
      <div class="mx-auto w-24 h-24 rounded-full border-2" style="border-color: var(--accent); display:grid; place-items:center;">
        <svg class="ring" width="56" height="56" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M12 3l2 3-2 3-2-3 2-3z" stroke="#C9A227" stroke-width="1.5" fill="none"/>
          <circle cx="12" cy="16" r="6.5" stroke="#C9A227" stroke-width="1.5" fill="none"/>
        </svg>
      </div>
      <h1 class="text-4xl md:text-5xl font-bold mt-4" style="font-family: 'Playfair Display', serif;">Eric & Darya</h1>
      <p class="text-slate-600 mt-1">August 23, 2025</p>
      <p class="text-slate-600 text-sm">Please keep it PG. By uploading you grant permission to share privately with our guests.</p>
    </header>

    <!-- upload -->
    <section class="bg-white rounded-2xl p-6 md:p-7 card">
      <h2 class="text-xl font-semibold flex items-center gap-2">
        <span>Upload photos & videos</span>
      </h2>
      <p class="text-slate-600 mt-1 text-sm">Max 200 MB each • JPG/PNG/HEIC/WEBP/MP4/MOV • Use the passcode printed on the program.</p>

      <form id="uploadForm" class="mt-4 grid gap-3">
        <div class="grid md:grid-cols-3 gap-3">
          <input name="name" required placeholder="Your name" class="border rounded-xl px-4 py-3 focus:outline-none focus:ring w-full"/>
          <input name="passcode" required placeholder="Passcode" class="border rounded-xl px-4 py-3 focus:outline-none focus:ring w-full"/>
          <input id="file" name="file" type="file" multiple accept="image/*,video/*" required class="border rounded-xl px-4 py-3 focus:outline-none focus:ring w-full"/>
        </div>

        <div class="flex flex-col sm:flex-row gap-3 sm:items-center mt-1">
          <button id="submitBtn" class="rounded-xl px-5 py-3 font-semibold text-white w-full sm:w-auto hover:opacity-95 disabled:opacity-50" style="background: var(--ink);" type="submit">Upload selected</button>
          <span class="text-xs text-slate-500">You can select multiple files; they’ll upload one by one.</span>
        </div>

        <div class="hidden" id="progressWrap">
          <div class="flex justify-between text-sm text-slate-600"><span id="progressLabel">Uploading…</span><span id="progressText">0%</span></div>
          <div class="w-full bg-slate-200 rounded-full h-2 overflow-hidden">
            <div id="progressBar" class="h-2 w-0" style="background: var(--accent);"></div>
          </div>
        </div>

        <p id="message" class="text-sm mt-2"></p>
      </form>
    </section>

    <!-- gallery -->
    <section class="mt-10">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold">Live gallery</h2>
        <div class="flex items-center gap-3">
          <button id="refreshBtn" class="text-sm underline">Refresh</button>
        </div>
      </div>
      <div id="gallery" class="mt-4 grid grid-cols-2 md:grid-cols-3 gap-3"></div>
    </section>

    <footer class="text-center text-slate-500 text-xs mt-10">
      <p>© August 23, 2025 Eric & Darya</p>
    </footer>
  </main>

<script>
const WORKER_BASE = "https://broken-tree-9fda.haoyuandu96.workers.dev";

const form = document.getElementById('uploadForm');
const msg  = document.getElementById('message');
const progressWrap = document.getElementById('progressWrap');
const progressBar  = document.getElementById('progressBar');
const progressText = document.getElementById('progressText');
const progressLabel= document.getElementById('progressLabel');
const submitBtn    = document.getElementById('submitBtn');
const fileInput    = document.getElementById('file');

form.addEventListener('submit', async (e) => {{
  e.preventDefault();
  msg.textContent = "";
  const files = Array.from(fileInput.files || []);
  if (!files.length) return;

  submitBtn.disabled = true;
  progressWrap.classList.remove('hidden');

  try {{
    for (let i = 0; i < files.length; i++) {{
      const file = files[i];
      if (file.size > 200 * 1024 * 1024) {{
        msg.textContent = "One of your files is too large (max 200MB).";
        msg.className = "text-red-600 text-sm mt-2";
        continue;
      }}
      const fd = new FormData(form);
      fd.set('file', file);
      progressLabel.textContent = "Uploading " + (i+1) + " of " + files.length + "…";

      await new Promise((resolve, reject) => {{
        const xhr = new XMLHttpRequest();
        xhr.open('POST', WORKER_BASE + '/api/upload');
        xhr.upload.onprogress = (ev) => {{
          if (ev.lengthComputable) {{
            const pct = Math.round((ev.loaded / ev.total) * 100);
            progressBar.style.width = pct + '%';
            progressText.textContent = pct + '%';
          }}
        }};
        xhr.onload = () => (xhr.status >= 200 && xhr.status < 300) ? resolve() : reject(new Error(xhr.responseText || 'Upload failed'));
        xhr.onerror = () => reject(new Error('Network error'));
        xhr.send(fd);
      }});
    }}
    msg.textContent = "Thank you! Upload(s) complete.";
    msg.className = "text-green-700 text-sm mt-2";
    form.reset();
    progressBar.style.width = '0%'; progressText.textContent = '0%';
    await loadGallery();
  }} catch (err) {{
    try {{ const e = JSON.parse(err.message); msg.textContent = e.error || "Upload failed"; }}
    catch {{ msg.textContent = err.message || "Upload failed"; }}
    msg.className = "text-red-600 text-sm mt-2";
  }} finally {{
    submitBtn.disabled = false;
    progressWrap.classList.add('hidden');
  }}
}});

async function loadGallery(){{
  const gallery = document.getElementById('gallery');
  gallery.innerHTML = '';
  try{{
    const res = await fetch(WORKER_BASE + '/api/list');
    const {{ items }} = await res.json();
    (items || []).forEach(it => {{
      const type = (it.contentType || '').split('/')[0];
      const card = document.createElement('div');
      card.className = 'bg-white rounded-xl card overflow-hidden';
      if (type === 'video') {{
        const v = document.createElement('video');
        v.src = it.url; v.controls = true; v.playsInline = true;
        v.className = 'w-full h-48 object-cover';
        card.appendChild(v);
      }} else {{
        const img = document.createElement('img');
        img.src = it.url; img.alt = it.name || 'Upload'; img.loading='lazy';
        img.className = 'w-full h-48 object-cover';
        card.appendChild(img);
      }}
      const meta = document.createElement('div');
      meta.className = 'p-3 text-sm text-slate-600 flex items-center justify-between';
      const date = new Date(it.uploadedAt);
      meta.innerHTML = "<span>" + (it.uploader || 'Guest') + "</span><span>" + (isNaN(date) ? '' : date.toLocaleString()) + "</span>";
      card.appendChild(meta);
      gallery.appendChild(card);
    }});
  }}catch(e){{ console.error(e); }}
}}
document.getElementById('refreshBtn').addEventListener('click', loadGallery);
loadGallery();
</script>
</body>
</html>
